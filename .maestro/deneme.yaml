appId: com.pozitron.hepsiburada
---
- launchApp:
    clearState: true # Teste temiz bir başlangıç yapmak için uygulamanın önbelleğini temizler

# ==========================================
# 1. ARAMA VE LİSTELEME İŞLEMİ
# ==========================================
- tapOn:
    id: searchTextField
- inputText: "Adidas ayakkabi"
- pressKey: Enter

- extendedWaitUntil:
    visible: "Hızlı Teslimat" # Arama sonuçlarının tam yüklendiğinden emin olmak için bekleriz
    timeout: 15000
- assertVisible:
    id: addToCart
    index: 0

# Filtreleme öncesi toplam ürün sayısını hafızaya alma
- copyTextFrom:
    id: tvTitle
- evalScript: ${output.resultsBefore = maestro.copiedText.replace(/[^0-9]/g, "")} # "10.000+ ürün" metninden sadece rakamları çeker
- assertVisible:
    text: ".*[aA]didas.*" # Çıkan sonuçların Adidas içerdiğini Regex ile doğrula

# ==========================================
# 2. FİLTRELERİN UYGULANMASI
# ==========================================
- tapOn:
    point: 4%,11% # Filtreler ikonunun bulunduğu konuma tıklar

# Beden ve Fiyat filtreleri (Metin girişli alanlar)
- tapOn: Beden
- tapOn: Ara
- inputText: "42"
- tapOn:
    text: "42"
    index: 1
- tapOn: Uygula

- tapOn: Fiyat Aralığı
- tapOn: En az
- inputText: "3000"
- tapOn: En çok
- inputText: "5000"
- hideKeyboard
- tapOn: Uygula

# Renk ve Cinsiyet filtreleri (Doğrudan seçim)
- tapOn: Renk
- tapOn: Beyaz
- tapOn: Uygula

- tapOn: Cinsiyet
- tapOn: Erkek
- tapOn: Uygula

- tapOn:
    id: btnApply # Tüm filtreleri ana listeye uygular

- extendedWaitUntil:
    visible: ".*TL.*"
    timeout: 15000

# Filtrelerin çalıştığını doğrulamak için yeni sayıyı eski sayıyla kıyaslama
- copyTextFrom:
    id: tvTitle
- evalScript: ${output.resultsAfter = maestro.copiedText.replace(/[^0-9]/g, "")}
- assertTrue: ${output.resultsAfter != output.resultsBefore} # Sonuç sayısı değiştiyse filtreler başarıyla çalışmıştır

# ==========================================
# 3. SEÇİLİ FİLTRELERİN DOĞRULANMASI
# ==========================================
# Not: Yatay menüde ilgili filtreyi bulana kadar sağdan sola kaydırır (swipe)

# --- Cinsiyet Kontrolü ---
- repeat:
    times: 4
    commands:
      - runFlow:
          when:
            notVisible: "Cinsiyet"
          commands:
            - swipe:
                start: "90%, 10%" 
                end: "25%, 10%"   
                duration: 1000
- assertVisible: Cinsiyet
- tapOn: Cinsiyet
- assertVisible:
    text: Erkek
- assertVisible:
    id: cbMultiSelection
    checked: true # Checkbox'ın işaretli olduğunu teyit eder
- swipe:
    from:
      id: divider
    direction: DOWN # Filtre detayını aşağı kaydırarak kapatır
- swipe:
    start: "25%, 10%"
    end: "90%, 16%"
    duration: 5000 # Menüyü diğer filtreler için tekrar en başa sarar

# --- Fiyat Aralığı Kontrolü ---
- repeat:
    times: 4
    commands:
      - runFlow:
          when:
            notVisible: "Fiyat Aralığı"
          commands:
            - swipe:
                start: "90%, 10%" 
                end: "25%, 10%"   
                duration: 1000
- assertVisible: Fiyat Aralığı
- tapOn: Fiyat Aralığı
- assertVisible: 3000 - 5000 TL
- assertVisible:
    id: rbSingleSelection
    checked: true
- swipe:
    from:
      id: divider
    direction: DOWN
- swipe:
    start: "25%, 10%"
    end: "90%, 16%"
    duration: 5000

# --- Beden Kontrolü ---
- repeat:
    times: 4
    commands:
      - runFlow:
          when:
            notVisible: "Beden"
          commands:
            - swipe:
                start: "90%, 10%" 
                end: "25%, 10%"   
                duration: 1000
- assertVisible: Beden
- tapOn: Beden
- assertVisible: "42"
- assertVisible:
    id: cbMultiSelection
    checked: true
- swipe:
    from:
      id: divider
    direction: DOWN
- swipe:
    start: "25%, 10%"
    end: "90%, 16%"
    duration: 5000

# --- Renk Kontrolü ---
- repeat:
    times: 4
    commands:
      - runFlow:
          when:
            notVisible: "Renk"
          commands:
            - swipe:
                start: "90%, 10%" 
                end: "25%, 10%"   
                duration: 1000
- assertVisible: Renk
- tapOn: Renk
- assertVisible: Beyaz
- assertVisible:
    id: cbMultiSelection
    checked: true
- swipe:
    from:
      id: divider
    direction: DOWN

# ==========================================
# 4. ÜRÜNÜ SEPETE EKLEME VE SEPET ONAYI
# ==========================================
- assertVisible:
    id: addToCart
    index: 0
- tapOn:
    point: "30%,38%" # İlk ürünün detayına gitmek için koordinata tıklar

- extendedWaitUntil:
    visible: "Sepete Ekle"
    timeout: 10000
- tapOn:
    id: pdpAddToCart

- extendedWaitUntil:
    visible: "Sepete git" # Ürünün eklendiğine dair çıkan bildirimi bekler
    timeout: 10000
- tapOn: Sepete git

- extendedWaitUntil:
    visible:
      id: basketPage_headerText
    timeout: 10000

# Sepet boşsa testi kasıtlı olarak patlatır (Fail)
- runFlow:
    when:
      visible: "Sepetin şu an boş"
    commands:
      - assertTrue: ${false}

- extendedWaitUntil:
    visible: "Ödemeye Geç"
    timeout: 10000

# Sepetteki ürünün detaylarının (Marka, Renk, Beden) doğrulanması
- assertVisible:
    id: productName
- assertVisible:
    id: productName
    text: ".*[aA]didas.*"
- assertVisible: ".*Beyaz.*"
- assertVisible: ".*42.*"